<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:ClientApp.Src.ViewModels"
             xmlns:controls="clr-namespace:ClientApp.Src.Controls"
             xmlns:components="clr-namespace:ClientApp.Src.Components"
             xmlns:windows="clr-namespace:Microsoft.Maui.Controls.PlatformConfiguration.WindowsSpecific;assembly=Microsoft.Maui.Controls"
             x:Class="ClientApp.Src.Views.HomePage">
    <ContentPage.BindingContext>
        <viewModels:HomeViewModel/>
    </ContentPage.BindingContext>

    <Shell.TitleView>
        <!--Верхняя шапочка с профилем и поиском-->
        <Grid ColumnDefinitions="auto, *, auto" ColumnSpacing="10" VerticalOptions="Center">
            <Grid.Padding>
                <OnPlatform x:TypeArguments="Thickness" Default="10,0,10,0">
                    <On Platform="Android" Value="0,0,15,0"/>
                </OnPlatform>
            </Grid.Padding>
            <!--Аватарка пользователя-->
            <Frame CornerRadius="100" BorderColor="Transparent" Padding="-1" WidthRequest="40" HeightRequest="40">
                <Image Source="avatar.png" Aspect="AspectFill" WidthRequest="40" HeightRequest="40"/>
            </Frame>
            <!--Строка поиска-->
            <controls:MinIconEntry IconSource="search.png" PlaceholderText="Search..." Grid.Column="1" VerticalOptions="Center"/>
            <!--Перезагрузка-->
            <ImageButton x:Name="refreshButton" Grid.Column="2" Source="refresh.png" Command="{Binding TryFetchCommand}"/>
        </Grid>
    </Shell.TitleView>

    <Grid>
        <!--Содержимое страницы-->
        <controls:CustomRefreshView Grid.Row="1" Command="{Binding TryFetchCommand}">
            <StackLayout>
                <!--Карточка с топ-новостью-->
                <components:BigNewsCard/>

                <Label BackgroundColor="{StaticResource Gray100}" HorizontalOptions="FillAndExpand" HeightRequest="1"/>

                <!--Разделы содержимого-->
                <StackLayout Spacing="{StaticResource MarginMax}" Padding="{StaticResource TopBottomMarginMax}">
                    <!--Категории-->
                    <components:TitledContentTemplate Title="TOP CATEGORY" ShowMore="True">
                        <CollectionView ItemsSource="{Binding Categories}">
                            <CollectionView.ItemsLayout>
                                <GridItemsLayout Orientation="Horizontal"
                                                         HorizontalItemSpacing="{StaticResource MarginPreMin}"/>
                            </CollectionView.ItemsLayout>
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <components:CategoryCard  IconSource="{Binding Image.Path}" Text="{Binding Name}" CardColor="{Binding BackgroundColor}" WidthRequest="179"/>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </components:TitledContentTemplate>
                    <!--РЕКОМЕНДАЦИИ-->
                    <StackLayout Padding="{StaticResource LeftRightMarginLarge}" Spacing="{StaticResource MarginSmall}">
                        <Label Text="MOST READ" FontSize="16" FontAttributes="Bold" FontFamily="Nunito"/>
                        <!--Большая карторчка для первой рекомендации-->
                        <components:DefaultNewsCard FilteredNews="{Binding MostReadNewsTop}"/>
                        <!--Остальные мини карточки-->
                        <CollectionView ItemsSource="{Binding MostReadNewses}">
                            <CollectionView.ItemsLayout>
                                <LinearItemsLayout Orientation="Vertical" ItemSpacing="{StaticResource MarginSmall}"/>
                            </CollectionView.ItemsLayout>
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <components:MinNewsCard FilteredNews="{Binding .}"/>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </StackLayout>

                    <Label BackgroundColor="{StaticResource Gray100}" HorizontalOptions="FillAndExpand" HeightRequest="1"/>

                    <!--ПОСЛЕДНИЕ НОВОСТИ-->
                    <StackLayout Padding="{StaticResource LeftRightMarginLarge}" Spacing="{StaticResource MarginSmall}">
                        <Label Text="LATEST NEWS" FontSize="16" FontAttributes="Bold" FontFamily="Nunito"/>
                        <!--Остальные мини карточки-->
                        <CollectionView ItemsSource="{Binding MostReadNewses}">
                            <CollectionView.ItemsLayout>
                                <LinearItemsLayout Orientation="Vertical" ItemSpacing="{StaticResource MarginSmall}"/>
                            </CollectionView.ItemsLayout>
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <components:MinNewsCard FilteredNews="{Binding .}"/>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </StackLayout>
                </StackLayout>
            </StackLayout>
        </controls:CustomRefreshView>

        
    </Grid>
</ContentPage>